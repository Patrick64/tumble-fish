var Game=function(){function n(a,b,c){b=0;a=90-a;document.getElementById("imgLogo").style.webkitTransform="rotate("+a+"deg) rotate3d(1,0,0, "+b*-1+"deg)";document.getElementById("imgLogo").style.transform="rotate("+a+"deg) rotate3d(1,0,0, "+b*-1+"deg)"}var a=this;var b=this;this.LR=0;this.FB=0;this.DIR=0;var c=10;this.c=document.getElementById("myCanvas");this.viewportwidth=window.innerWidth;this.viewportheight=window.innerHeight;this.c.style.height=this.viewportheight+"px";this.c.style.width=this.viewportwidth+"px";this.width=400;this.height=this.viewportheight/this.viewportwidth*this.width;var d=this.width/20;var e=this.width/40;this.c.setAttribute("width",this.width);this.c.setAttribute("height",this.height);var f=a.c.getContext("2d");this.centerX=this.width/2;this.centerY=this.height/2;var g=(new Date).getTime();var h=0;var i=[{wallMap:"        __I__.____        __I____.._        ..I...____        ..______..        ___I_..___        ..........        ..........        ..........        __________        0000000000",itemMap:"        ..p....p..        ....p.....      ",width:5}];var j=Class.extend({init:function(a,b,c){this.momentum={x:0,y:0};this.unit=c.unit;this.level=c;this.nearWall="";this.x=a;this.y=b;this.tilt=1},process:function(a){this.momentum.x=this.momentum.x*(1-a*20);this.momentum.x+=a/20*b.LR*this.tilt;this.x+=this.momentum.x;this.y+=this.momentum.y;var c=Math.floor(this.x+.5);var d=Math.floor(this.y+.5);if(c>=0&&c<this.level.width&&d>=0&&this.level.wallMap[c+d*this.level.width])this.nearWall=this.level.wallMap[c+d*this.level.width];if(this.nearWall==".")this.momentum.y+=a*.4;if(this.nearWall=="_"){if(this.y>=d){this.y=d;this.momentum.y=0}else{this.momentum.y+=a*.4}}if(this.momentum.y>a*100)this.momentum.y=a*100;if(this.momentum.x>a*50)this.momentum.x=a*50;if(this.momentum.x<-a*50)this.momentum.x=-a*50;if(this.x<-1)this.x=this.level.width;if(this.x>this.level.width+1)this.x=-1},draw:function(){f.fillStyle="blue";f.save();f.translate((this.x+.5)*this.unit,(this.y+.5)*this.unit);f.save();f.rotate(-(a.LR*1)*Math.PI/180);f.beginPath();f.arc(0,0,this.unit/2,-.3,1.1*Math.PI,false);f.fillStyle="rgba(1,1,255,0.7);";f.fill();f.restore();f.beginPath();f.arc(0,0,this.unit/2,-1,1.3*Math.PI,false);f.lineWidth=5;f.strokeStyle="#bbf";f.stroke();f.restore();f.font="50px arial";f.fillText(h,0,50)}});var k=j.extend({init:function(a,b,c){this._super(a,b,c)},process:function(a){this._super(a)},draw:function(){f.fillStyle="blue";f.save();f.translate((this.x+.5)*this.unit,(this.y+.5)*this.unit);f.save();f.rotate(-(a.LR*1)*Math.PI/180);f.beginPath();f.arc(0,0,this.unit/2,-.3,1.1*Math.PI,false);f.fillStyle="rgba(1,1,255,0.7);";f.fill();f.restore();f.beginPath();f.arc(0,0,this.unit/2,-1,1.3*Math.PI,false);f.lineWidth=5;f.strokeStyle="#bbf";f.stroke();f.restore();f.font="50px arial";f.fillText(h,0,50)}});var l=function(a){this.unit=b.width/a.width;this.levelData=a;this.width=a.width;this.wallMap=a.wallMap.replace(/\s|\n/g,"");var c=a.itemMap.replace(/\s|\n/g,"");var d=[];var e=this;for(var g=0;g<c.length;g++){h=g%a.width;i=Math.floor(g/a.width);if(c[g]=="p")d.push(new k(h,i,this))}var h,i;this.processLevel=function(a){for(var b=0;b<d.length;b++){d[b].process(a)}};this.drawLevel=function(){for(var b=0;b<e.wallMap.length;b++){h=b%a.width;i=Math.floor(b/a.width);f.fillStyle="white";if(e.wallMap[b]=="_"||e.wallMap[b]=="I")f.fillRect(h*e.unit,i*e.unit+e.unit,e.unit,e.unit/10);if(e.wallMap[b]=="I")f.fillRect(h*e.unit+e.unit*.45,i*e.unit,e.unit/10,e.unit)}for(var b=0;b<d.length;b++){d[b].draw()}}};var m=new l(i[0]);window.setInterval(function(){var b;h=(new Date).getTime()-g;g=(new Date).getTime();for(b=0;b<h-10;b=b+10){m.processLevel(10/1e3)}m.processLevel((h-b)/1e3);a.drawBackground();m.drawLevel()},1e3/c);this.drawBackground=function(){f.fillStyle="#000";f.fillRect(0,0,a.width,a.height);f.save();f.translate(a.width/2,0);f.rotate(-(a.LR*1)*Math.PI/180);f.translate(-(a.width/2),-a.height/4);var b=d;for(var c=0;c<255;c=c+20){f.fillStyle="rgb("+(255-c)*1+","+(255-c)+",0)";f.fillRect(-a.width,c/256*a.height,a.width*3,22/256*a.height)}f.restore();var e=70;f.beginPath();f.arc(a.centerX,a.centerY,e,0,2*Math.PI,false);f.fillStyle="rgba(188,48,48,0.3);";f.fill();f.lineWidth=5;f.strokeStyle="black";f.stroke()};if(window.DeviceOrientationEvent){console.log("DeviceOrientation is supported");window.addEventListener("deviceorientation",function(b){a.LR=b.gamma;a.FB=b.beta;a.DIR=b.alpha},false)}else{alert("Not supported on your device or browser.  Sorry.")}};var app=new Game